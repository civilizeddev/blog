---
layout: post
title: "[Lagom] 메시지 브로커 지원"
excerpt: "Scala Home » Lagom reference guide » Decouple services with a message broker"
date: 2019-01-16
tags:
  - lagom
  - kafka
comments: true
---

> 원문: https://www.lagomframework.com/documentation/latest/scala/MessageBroker.html

# 메시지 브로커 지원

한 서비스에서 다른 서비스가 소유한 데이터를 가져오는 두 가지 전략이 있다.

* 데이터를 소유한 서비스에 요청을 보내고, 응답을 기다리는 **동기적 통신 패턴**
* 데이터를 소유한 서비스가, 일정 시간 동안 데이터를 저장하는 인프라 컴포넌트로[^1] 데이터를 내보내도록 아키텍처를 구성할 수 있다. 이로써 데이터의 발행과 사용이 별개의 시간에 이루어지도록 하여 서비스를 효과적으로 디커플링할 수 있다. 즉 서비스간에 **비동기적 통신**이 가능하게 된다.

마이크로서비스가 서로간에 동기적 통신을 사용하는 것은 잘못된 아키텍처의 징후다. 마이크로서비스 아키텍처에서는 실패의 가능성이 많다. **동기적**이라는 말의 뜻은 **무엇인가 동시에 일어난다**는 뜻이다. 즉 동기적 통신에서는 데이터의 송신자와 수신자가 동시에 움직이게 된다. 이는 실패가 발생할 때 통신 또한 실패한다는 말이다. 메시지가 유실되면 일관성 문제도 발생하고, 한 서비스 컴포넌트의 실패가 전체 시스템의 실패로 이어진다.

해결 방법은 동기적 통신 방식을 지양하고, 비동기적 방식으로 시스템을 구성하는 것이다. 알아차렸겠지만, 어떤 인프라 컴포넌트를 도입하면 서비스가 비동기적 통신을 할 수 있게 된다. 흔히 **메시지 브로커**라고 불리는 것이다. 메시지 브로커로 사용할 수 있는 다양한 기술이 있다. 구글 클라우드 Pub/Sub, **아파치 카프카**, RabbitMQ 같은 것들이다.

라곰은 동기/비동기적 통신을 모두 지원한다. 동기적 방식을 써야할 때도 있겠지만, **가능하면 언제나 비동기적 통신 방식을 사용하도록** 해야 한다. 이를 위해 라곰에서 메시지 브로커 API를 제공한다. 메시지 브로커 기술을 추상화해서 간단하게 서비스 간의 비동기적 통신을 가능하게 한다. 현재로서는 아파치 카프카를 이용한 메시지 브로커 API 구현체만 제공한다. 다른 것들은 나중에 제공될 것이다.

# 요약

- 마이크로서비스간의 통신은 비동기적으로 해야 한다.
- 라곰에서는 카프카용 메시지 브로커 API 제공한다.

---

[^1]: 메시지 브로커를 가리킨다.
